# hexlet-slim-example

> CRUD — акроним, обозначающий четыре базовые функции: создание (англ. create), чтение (read), модификация (update), удаление (delete)

Создание полного круда включает в себя следующие действия:

* Создание сущности в коде (как правило класса)
* Добавление таблицы в базу
* Написание тестов на обработчики
* Добавление обработчиков
* Добавление шаблонов


## CRUD by this example

|   Глагол  |      Маршрут     |       Шаблон      |              Описание       |
|:---------:|:----------------:|:-----------------:|:---------------------------:|
|    GET    |      /posts      | posts/index.phtml |        Список постов        |
|    GET    |    /posts/{id}   |  posts/show.phtml |        Страница поста       |
|    GET    |    /posts/new    |  posts/new.phtml  | Форма создания нового поста |
|    POST   |      /posts      |                   |    Создание нового поста    |
|    GET    | /posts/{id}/edit |  posts/edit.phtml |  Форма редактирования поста |
| PATCH/PUT |    /posts/{id}   |                   |       Обновление поста      |
|   DELETE  |    /posts/{id}   |                   |        Удаление поста       |


### Список постов(index)
Общий алгоритм:

1. Извлекаем список из хранилища (базы данных). Обычно с учетом пейджинга.
2. Передаем данные в шаблон
3. Выводим данные в шаблоне используя цикл

Обычно в этот список добавляют различные действия, которые можно выполнять над сущностями, например, редактирование, удаление или просмотр

### Создание (new)
Создание сущности, включает в себя два действия: отображение формы и обработка данных формы. За каждое из этих действий отвечает свой собственный маршрут. 

* GET /posts/new
* POST /posts

Если данные формы оказались не валидны, то обработчик рисует форму обработчика `posts/new` и отправляет её вместе с кодом ответа 422 (Unprocessable Entity).

### Отображение (show)
Страница конкретной сущности. Алгоритм:
1. Из адреса извлекается идентификатор сущности
2. Выполняется поиск сущности в хранилище
3. Она передается в шаблон
4. В шаблоне рисуется красивый вывод

Если сущность не определена: 404 или обработка через исключение

### Обновление (edit)
Алгоритм:
1. Поиск существующего поста по его id
2. Изменение его данных и сохранение 

Отдельные моменты:
* Обновление существующего поста в данном примере происходит руками 
```
$post['name'] = $postData['name'];
$post['body'] = $postData['body'];
```

* HTML позволяет указывать только два метода внутри атрибута `method` тега `<form>`. С точки зрения семантики HTTP, это не совсем верно.
*POST* предназначен для создания нового. Для изменения правильно использовать PATCH или PUT, в зависимости от того как происходит обновление, а для удаления — DELETE.
Большинство фреймворков использует один и тот же механизм для обхода этого ограничения. Он простой до безобразия. 
Если форма не поисковая, то данные в любом случае отправляются POST запросом, но в форму добавляется специальное скрытое поле с именем `_METHOD`, которое и говорит фреймворку, а какой метод мы бы хотели использовать:
```
<form action="/schools" method="post">
    <input type="hidden" name="_METHOD" value="PATCH">
    ...
</form>
```

### Удаление (delete)

Отдельные моменты:

1. Удаление делается запросов DELETE(по спецификации - идемпотентный)
2. Важный момент который можно упустить - кнопка удаления ни в коем случае не должна сразу удалять(в данном примере не реализована на front-end).
3. Безопасность: перед выполнением действия необходимо проверить авторизован ли пользователь на выполнение данного действия или нет.
4. Крайне важно соблюдать семантику HTTP. Ни в коем случае нельзя создавать HTML, в котором удаление происходит GET-запросом, например, по ссылке. Браузеры, их плагины и поисковые системы действуют в соответствии с семантикой HTTP. Если они видят обычную ссылку, то подразумевается что она не может выполнить деструктивных действий, а значит её можно посетить

[Библиотека для автоматизации фронтенд части (подстановка правильных глаголов, подтверждение)](https://github.com/rails/jquery-ujs)